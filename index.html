<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Noktra Airdrop</title>
  <link rel="stylesheet" href="style.css" />
  <script>window.NOKTRA_BACKEND_URL="https://noktra-airdrop-6r387ygq6-noktras-projects.vercel.app/api";</script>
</head>
<body>
  <div class="top-link">
    <a href="#nft-gallery">Gallery NFT Noktra</a>
  </div>
  <div class="background"></div>
  <img src="logo.png" alt="Noktra Logo" class="corner-logo" />

  <div id="nft-gallery" class="nft-gallery">
    <h2>NFT Gallery</h2>
    <div class="nft-items">
      <div class="nft-card">
        <img src="https://arweave.net/FK-p1idQ7L7JAWp0RmUWTzUXxAyMZ3J63X-0YQdCFEk" alt="NFT 1">
        <p>Noktra Genesis #1</p>
      </div>
      <div class="nft-card">
        <img src="https://arweave.net/gzH8e-VV2jwQ2x5DGVdHTrkqEYkYEdK99BbsYWeqPcg" alt="NFT 2">
        <p>Noktra Genesis #2</p>
      </div>
      <div class="nft-card">
        <img src="889DE7F5-6899-4172-A704-6EC2F9E3114A.png" alt="NFT 3">
        <p>Noktra Genesis #3</p>
      </div>
    </div>
  </div>

  <div class="language-switcher">
    <button onclick="setLanguage('en')">ðŸ‡¬ðŸ‡§ English</button>
    <button onclick="setLanguage('pl')">ðŸ‡µðŸ‡± Polski</button>
  </div>

  <div class="container">
    <h1 data-en="Noktra Airdrop" data-pl="Airdrop Noktra">Noktra Airdrop</h1>
    <p class="description" data-en="Noktra is a decentralized community token built on Solana. No inflation. No limits. For the people."
       data-pl="Noktra to zdecentralizowany token spoÅ‚ecznoÅ›ciowy zbudowany na Solanie. Bez dodruku. Bez barier. Dla ludzi.">
       Noktra is a decentralized community token built on Solana. No inflation. No limits. For the people.
    </p>
    <div class="token-info">
      <p><strong data-en="Token" data-pl="Token">Token</strong>: NOK</p>
      <p><strong data-en="Total Supply" data-pl="PodaÅ¼">Total Supply</strong>: 1,000,000,000</p>
      <p><strong data-en="Network" data-pl="SieÄ‡">Network</strong>: Solana</p>
      <p><strong>Token Address:</strong> <a href="https://solscan.io/token/48QzG8RhntaiPjY7z3mPqaDiK8TxDKetBKAKMZr1TbL" target="_blank">Solscan</a></p>
    </div>

    <p id="counter" style="text-align:center; font-weight:bold; margin-top:0.5rem; color:#00ffcc;">ZgÅ‚oszeÅ„: 0</p>

    <form id="airdrop-form">
      <input type="text" id="address" placeholder="Solana Address" required />
      <input type="text" id="twitter" placeholder="Twitter Username" required />
      <input type="text" id="telegram" placeholder="Telegram Username" required />
      <button type="submit" data-en="Submit to Airdrop" data-pl="ZgÅ‚oÅ› siÄ™ do airdropu">Submit to Airdrop</button>
    </form>
    <p id="message"></p>
    <div class="socials">
      <a href="https://phantom.app/" target="_blank" rel="noopener">Phantom Wallet</a> |
      <a href="https://x.com/Noktra1755" target="_blank" rel="noopener">Twitter</a> |
      <a href="https://t.me/Noktra_AirDrop" target="_blank" rel="noopener">Telegram</a>
    </div>
  </div>

  <script src="script.js"></script>

  <!-- Minimalny licznik: backend (global) + fallback lokalny -->
  <script>
    (function(){
      const backend = (typeof window!=='undefined' && window.NOKTRA_BACKEND_URL) ? String(window.NOKTRA_BACKEND_URL) : '';
      const keyCount = 'noktra-airdrop-count';
      const keySub = 'noktra-airdrop-submissions';

      function getLocalCount(){ return parseInt(localStorage.getItem(keyCount) || '0', 10); }
      function setLocalCount(v){ localStorage.setItem(keyCount, String(v)); }
      function renderCount(v){
        var el = document.getElementById('counter');
        if(!el) return;
        var n = (typeof v==='number') ? v : getLocalCount();
        el.textContent = 'ZgÅ‚oszeÅ„: ' + n;
      }
      async function fetchGlobal(){
        if(!backend) return;
        try{
          const r = await fetch(backend.replace(/\/$/,'') + '/count');
          if(!r.ok) return;
          const d = await r.json();
          if(typeof d.count === 'number'){ setLocalCount(d.count); renderCount(d.count); }
        }catch(_){}
      }
      function isValidAddr(a){ return !!a && a.length>=32 && a.length<=60 && /^[1-9A-HJ-NP-Za-km-z]+$/.test(a); }
      function getSubmitted(){ try{ return JSON.parse(localStorage.getItem(keySub)||'{}'); }catch{return {}} }
      function saveSubmitted(m){ localStorage.setItem(keySub, JSON.stringify(m)); }
      function setMsg(t,err){ var m=document.getElementById('message'); if(!m) return; m.textContent=t; m.style.color=err?'#ff6b6b':'#00ff88'; }

      document.addEventListener('DOMContentLoaded', function(){
        renderCount();
        fetchGlobal();

        var f = document.getElementById('airdrop-form');
        if(!f) return;

        f.addEventListener('submit', async function(e){
          e.preventDefault();
          var addr = document.getElementById('address')?.value.trim();
          var tw = document.getElementById('twitter')?.value.trim();
          var tg = document.getElementById('telegram')?.value.trim();

          if(!isValidAddr(addr)) return setMsg('NieprawidÅ‚owy adres Solana.', true);
          if(!tw || !tg) return setMsg('UzupeÅ‚nij Twitter oraz Telegram.', true);

          var submitted = getSubmitted();
          if(submitted[addr]) return setMsg('Ten adres juÅ¼ zÅ‚oÅ¼yÅ‚ zgÅ‚oszenie.', true);

          try{
            if(backend){
              const r = await fetch(backend.replace(/\/$/,'') + '/submit', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ address: addr, twitter: tw, telegram: tg })
              });
              if(r.ok){
                const d = await r.json();
                if(d?.ok && typeof d.count==='number'){
                  submitted[addr] = { tw, tg, ts: Date.now() }; saveSubmitted(submitted);
                  setLocalCount(d.count); renderCount(d.count); f.reset(); return setMsg('ZgÅ‚oszenie przyjÄ™te. DziÄ™kujemy!', false);
                }
                if(d?.error==='duplicate') return setMsg('Ten adres juÅ¼ zÅ‚oÅ¼yÅ‚ zgÅ‚oszenie.', true);
              }
            }
          }catch(_){}

          // fallback lokalny
          submitted[addr] = { tw, tg, ts: Date.now() }; saveSubmitted(submitted);
          setLocalCount(getLocalCount()+1); renderCount(); f.reset(); setMsg('ZgÅ‚oszenie przyjÄ™te (lokalnie).', false);
        });
      });
    })();
  </script>
</body>
</html>
